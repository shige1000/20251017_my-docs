# はじめに

Gitリポジトリにおけるシークレット（機密情報）管理の3つの主要な段階について、簡潔にまとめます。

## 1. 検出 (Detect) 🔍

リポジトリの**全履歴**をスキャンし、既にコミットされているシークレットを特定します。

| 目的 | ツール | コマンド (例) |
| :--- | :--- | :--- |
| **リポジトリ全体をスキャン** | **Gitleaks** | `gitleaks detect --source=.` |
| **高精度な検出** | **Trufflehog** | `trufflehog git file://.` |

## 2. 検出後削除 (Remediate) 🧹

検出されたシークレットを**Gitの過去のコミット履歴から完全に削除**し、リポジトリの整合性を確保します。

| 目的 | ツール | コマンド (例) |
| :--- | :--- | :--- |
| **履歴の書き換え** | **BFG Repo-Cleaner** | `bfg --delete-files <ファイル名>` |
| **履歴の書き換え** | **git filter-repo** | `git filter-repo --invert-paths --path <ファイル名>` |
| **注意点** | これらのコマンドは**リポジトリの履歴を書き換える**ため、実行後は他の共同作業者に**リポジトリの再クローン**が必要です。 |

## 3. 今後の予防 (Prevent) 🛡️

シークレットが**将来的にコミットされるのを防ぐ**ための対策を導入します。

| 目的 | ツール/方法 | コマンド (例) |
| :--- | :--- | :--- |
| **コミット前のチェック** | **Gitleaks (Pre-commit)** | CI/CDパイプラインや `pre-commit` フックに `gitleaks` を組み込み、シークレットを含むコミットを拒否します。 |
| **ファイル暗号化** | **Git-Secret** | `git secret add <ファイル名>` → `git secret hide` (シークレットを暗号化してコミットします) |
| **対象外設定** | **`.gitignore`** | シークレットファイル（例: `.env`）はGitの管理対象外にし、誤コミットを予防します。 |